<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>...</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a2e;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            overflow: hidden;
            padding: 20px;
            position: relative;
        }

        .snake-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
        }

        .snake-segment {
            position: absolute;
            width: 15px;
            height: 15px;
            background: linear-gradient(135deg, #ffffff, #e0e0e0);
            border: 2px solid #bdbdbd;
            border-radius: 2px;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.8);
            transition: all 0.1s linear;
        }

        .snake-segment.head {
            background: linear-gradient(135deg, #ffffff, #f5f5f5);
            border-color: #9e9e9e;
            box-shadow: 0 0 12px rgba(255, 255, 255, 1);
        }

        .main-wrapper {
            display: flex;
            gap: 20px;
            align-items: stretch;
            max-width: 900px;
            position: relative;
            z-index: 10;
        }

        .image-section {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-section img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 20px;
            border: 4px solid #FFD700;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
        }

        .container {
            flex: 1;
            text-align: center;
            padding: 25px 30px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            border: 4px solid #FFD700;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5), inset 0 0 15px rgba(255, 215, 0, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .container::after {
            content: 'â˜…';
            position: absolute;
            top: -12px;
            right: -12px;
            font-size: 30px;
            color: #FFD700;
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .mic-button {
            width: 90px;
            height: 90px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FF6B6B, #FFD93D);
            border: 4px solid #2C3E50;
            box-shadow: 0 5px 0 #1a252f, 0 6px 15px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 auto 20px;
            position: relative;
        }

        .mic-button:hover {
            background: linear-gradient(135deg, #FFD93D, #FF6B6B);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 7px 0 #1a252f, 0 9px 20px rgba(0, 0, 0, 0.5);
        }

        .mic-button:active {
            transform: translateY(2px);
            box-shadow: 0 3px 0 #1a252f, 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        .mic-button.recording {
            background: linear-gradient(135deg, #FF4757, #FFA502);
            animation: pulse 1.5s infinite, shake 0.5s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 6px 0 #1a252f, 0 0 0 0 rgba(255, 71, 87, 0.7);
            }
            50% {
                box-shadow: 0 6px 0 #1a252f, 0 0 0 20px rgba(255, 71, 87, 0);
            }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .mic-icon {
            font-size: 40px;
        }

        .instruction {
            color: #2C3E50;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
            margin-bottom: 15px;
            text-shadow: 1px 1px 0px rgba(255, 215, 0, 0.5);
            letter-spacing: 0.5px;
        }

        .transcript-box {
            background: #FFFACD;
            border: 3px solid #2C3E50;
            border-radius: 15px;
            padding: 15px;
            margin-top: 20px;
            min-height: 60px;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.2);
            position: relative;
        }

        .transcript-box::before {
            content: 'ðŸ’­';
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 24px;
        }

        .transcript-label {
            color: #FF6B6B;
            font-size: 11px;
            font-family: 'Bangers', cursive;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .transcript-text {
            color: #2C3E50;
            font-size: 16px;
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
            line-height: 1.4;
            min-height: 24px;
        }

        .status-message {
            color: #2C3E50;
            font-size: 13px;
            font-family: 'Comic Neue', cursive;
            font-weight: 700;
            margin-top: 15px;
            padding: 8px 16px;
            border-radius: 12px;
            display: inline-block;
        }

        .status-message.success {
            color: #27AE60;
            background: rgba(39, 174, 96, 0.2);
            border: 3px solid #27AE60;
            animation: bounce 0.5s;
        }

        .status-message.error {
            color: #E74C3C;
            background: rgba(231, 76, 60, 0.2);
            border: 3px solid #E74C3C;
            animation: shake 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .retry-btn {
            margin-top: 15px;
            padding: 10px 25px;
            background: linear-gradient(135deg, #3498DB, #2ECC71);
            border: 3px solid #2C3E50;
            border-radius: 20px;
            color: white;
            font-size: 14px;
            font-family: 'Bangers', cursive;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 0 #1a252f, 0 6px 12px rgba(0, 0, 0, 0.3);
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.3);
        }

        .retry-btn:hover {
            background: linear-gradient(135deg, #2ECC71, #3498DB);
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #1a252f, 0 8px 15px rgba(0, 0, 0, 0.4);
        }

        .retry-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1a252f, 0 3px 8px rgba(0, 0, 0, 0.2);
        }

        .loading {
            color: rgba(255, 255, 255, 0.6);
            font-size: 14px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="main-wrapper">
        <div class="snake-container" id="snakeContainer"></div>

        <div class="image-section">
            <img src="Gemini_Generated_Image_d0hqcjd0hqcjd0hq.png" alt="Obelix">
        </div>

        <div class="container">
            <div class="instruction" id="instruction">Cliquez sur le microphone et parlez</div>

            <div class="mic-button" id="micButton">
                <div class="mic-icon">ðŸŽ¤</div>
            </div>

            <div class="transcript-box">
                <div class="transcript-label">Transcription</div>
                <div class="transcript-text" id="transcriptText">...</div>
            </div>

            <div class="status-message" id="statusMessage"></div>

            <button class="retry-btn" id="retryBtn" style="display: none;">ðŸ”„ RÃ©essayer</button>
        </div>
    </div>

    <script>
        const micButton = document.getElementById('micButton');
        const instruction = document.getElementById('instruction');
        const transcriptText = document.getElementById('transcriptText');
        const statusMessage = document.getElementById('statusMessage');
        const retryBtn = document.getElementById('retryBtn');

        const GAME_URL = 'https://badis-tech.github.io/new/';
        const TRIGGER_WORDS = ['asterix', 'astÃ©rix', 'obelix', 'obÃ©lix'];

        let recognition;
        let isRecording = false;

        // Initialize Speech Recognition
        function initSpeechRecognition() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            if (!SpeechRecognition) {
                statusMessage.textContent = 'La reconnaissance vocale n\'est pas prise en charge dans ce navigateur. Utilisez Chrome, Edge ou Safari.';
                statusMessage.classList.add('error');
                return false;
            }

            recognition = new SpeechRecognition();
            recognition.continuous = false;  // Only listen once per button click
            recognition.interimResults = false;
            recognition.lang = 'fr-FR';
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                isRecording = true;
                micButton.classList.add('recording');
                instruction.textContent = 'Parlez maintenant...';
                statusMessage.textContent = '';
                statusMessage.className = 'status-message';
                transcriptText.textContent = '...';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                const confidence = event.results[0][0].confidence;

                console.log('Transcript:', transcript);
                console.log('Confidence:', confidence);

                // Display the transcript
                transcriptText.textContent = transcript;

                // Check if any trigger word is in the transcript
                const transcriptLower = transcript.toLowerCase();
                const wordFound = TRIGGER_WORDS.some(word =>
                    transcriptLower.includes(word.toLowerCase())
                );

                if (wordFound) {
                    statusMessage.textContent = 'âœ“ AccÃ¨s accordÃ© ! Redirection...';
                    statusMessage.classList.add('success');

                    // Redirect to game
                    setTimeout(() => {
                        window.location.href = GAME_URL;
                    }, 1000);
                } else {
                    statusMessage.textContent = 'âœ— Mot incorrect. Essayez de dire "AstÃ©rix" ou "ObÃ©lix"';
                    statusMessage.classList.add('error');
                    retryBtn.style.display = 'inline-block';
                }
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);

                isRecording = false;
                micButton.classList.remove('recording');
                instruction.textContent = 'Cliquez sur le microphone et parlez';

                if (event.error === 'no-speech') {
                    statusMessage.textContent = 'Aucune parole dÃ©tectÃ©e. Cliquez et rÃ©essayez.';
                    statusMessage.classList.add('error');
                } else if (event.error === 'not-allowed') {
                    statusMessage.textContent = 'AccÃ¨s au microphone refusÃ©. Autorisez l\'accÃ¨s et actualisez la page.';
                    statusMessage.classList.add('error');
                } else if (event.error === 'aborted') {
                    statusMessage.textContent = 'Enregistrement annulÃ©.';
                    statusMessage.classList.add('error');
                } else {
                    statusMessage.textContent = 'Erreur: ' + event.error;
                    statusMessage.classList.add('error');
                }

                retryBtn.style.display = 'inline-block';
            };

            recognition.onend = () => {
                isRecording = false;
                micButton.classList.remove('recording');
                instruction.textContent = 'Cliquez sur le microphone et parlez';
            };

            return true;
        }

        // Start recording on button click
        micButton.addEventListener('click', () => {
            if (!recognition && !initSpeechRecognition()) {
                return;
            }

            if (!isRecording) {
                retryBtn.style.display = 'none';
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting recognition:', error);
                    statusMessage.textContent = 'Erreur lors du dÃ©marrage. RÃ©essayez.';
                    statusMessage.classList.add('error');
                }
            } else {
                recognition.stop();
            }
        });

        // Retry button
        retryBtn.addEventListener('click', () => {
            retryBtn.style.display = 'none';
            statusMessage.textContent = '';
            statusMessage.className = 'status-message';
            transcriptText.textContent = '...';

            if (recognition) {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Error starting recognition:', error);
                }
            }
        });

        // Initialize on page load
        window.addEventListener('load', () => {
            initSpeechRecognition();
            initSnake();
        });

        // Snake Game Animation
        function initSnake() {
            const snakeContainer = document.getElementById('snakeContainer');
            const mainWrapper = document.querySelector('.main-wrapper');

            const snakeLength = 30;
            const segmentSize = 15;
            const speed = 2;

            let snake = [];
            let path = [];
            let currentPathIndex = 0;

            // Create snake segments
            for (let i = 0; i < snakeLength; i++) {
                const segment = document.createElement('div');
                segment.className = 'snake-segment';
                if (i === 0) segment.classList.add('head');
                snakeContainer.appendChild(segment);
                snake.push(segment);
            }

            // Generate perfect rectangular path around the wrapper
            function generatePath() {
                path = [];
                const rect = mainWrapper.getBoundingClientRect();

                const margin = 25;
                const step = 6;

                // Top edge (left to right) - perfect horizontal line
                for (let x = -margin; x < rect.width + margin; x += step) {
                    path.push({ x, y: -margin });
                }

                // Top-right corner
                path.push({ x: rect.width + margin, y: -margin });

                // Right edge (top to bottom) - perfect vertical line
                for (let y = -margin; y < rect.height + margin; y += step) {
                    path.push({ x: rect.width + margin, y });
                }

                // Bottom-right corner
                path.push({ x: rect.width + margin, y: rect.height + margin });

                // Bottom edge (right to left) - perfect horizontal line
                for (let x = rect.width + margin; x > -margin; x -= step) {
                    path.push({ x, y: rect.height + margin });
                }

                // Bottom-left corner
                path.push({ x: -margin, y: rect.height + margin });

                // Left edge (bottom to top) - perfect vertical line
                for (let y = rect.height + margin; y > -margin; y -= step) {
                    path.push({ x: -margin, y });
                }

                // Top-left corner (back to start)
                path.push({ x: -margin, y: -margin });
            }

            generatePath();

            // Animate snake
            function animate() {
                if (path.length === 0) return;

                currentPathIndex = (currentPathIndex + 1) % path.length;

                // Move each segment to follow the previous one
                for (let i = snakeLength - 1; i >= 0; i--) {
                    const pathIndex = (currentPathIndex - i * 2 + path.length) % path.length;
                    const pos = path[pathIndex];

                    snake[i].style.left = pos.x + 'px';
                    snake[i].style.top = pos.y + 'px';
                }

                requestAnimationFrame(animate);
            }

            // Regenerate path on window resize
            window.addEventListener('resize', generatePath);

            // Start animation
            animate();
        }

        // Keyboard shortcut (Space to record)
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && !isRecording) {
                e.preventDefault();
                micButton.click();
            }
        });
    </script>
</body>
</html>
